#!/bin/bash

cd `dirname $0`
odriverpmbuilt=`docker images | grep odriverpm | wc -l`

if [ "$odriverpmbuilt" == "       1" ]
then
  echo docker image already built
else
  docker build -t deciphernow/odriverpm:latest scripts
fi

ARG_VERSION=$1
if [ ${#1} -eq 0 ]
then
  ARG_VERSION="test"
fi

( ./makedocs )
docker run -i -e ODRIVE_PACKAGE_NAME="odrive-${ARG_VERSION}" -e ODRIVE_VERSION=${ARG_VERSION} -v `pwd`:/go/src/decipher.com/object-drive-server deciphernow/odriverpm:latest scripts/build.sh


